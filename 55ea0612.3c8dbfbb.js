(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{114:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return l})),a.d(t,"rightToc",(function(){return o})),a.d(t,"default",(function(){return s}));var r=a(3),n=a(7),c=(a(0),a(230)),i={title:"Elk"},l={unversionedId:"cloud/elk",id:"cloud/elk",isDocsHomePage:!1,title:"Elk",description:"Fork github docker-elk",source:"@site/docs\\cloud\\elk.md",slug:"/cloud/elk",permalink:"/dddtdd-docs/docs/cloud/elk",version:"current",lastUpdatedBy:"Colin Zuo",lastUpdatedAt:1606975164,sidebar:"docs",previous:{title:"Rancher",permalink:"/dddtdd-docs/docs/cloud/rancher"},next:{title:"Nginx",permalink:"/dddtdd-docs/docs/cloud/nginx"}},o=[{value:"Fork github docker-elk",id:"fork-github-docker-elk",children:[]},{value:"Create a branch",id:"create-a-branch",children:[]},{value:"Modify Settings",id:"modify-settings",children:[{value:"docker-compose.yml",id:"docker-composeyml",children:[]},{value:"elasticsearch/config/elasticsearch.yml",id:"elasticsearchconfigelasticsearchyml",children:[]},{value:"prepare images",id:"prepare-images",children:[]},{value:"prepare directories",id:"prepare-directories",children:[]},{value:"startup containers",id:"startup-containers",children:[]},{value:"setting-up-user-authentication",id:"setting-up-user-authentication",children:[]},{value:"Setup Filebeat",id:"setup-filebeat",children:[]},{value:"Setup Index Patterns on Kibana",id:"setup-index-patterns-on-kibana",children:[]},{value:"Save Popular Search",id:"save-popular-search",children:[]}]}],b={rightToc:o};function s(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(c.b)("wrapper",Object(r.a)({},b,a,{components:t,mdxType:"MDXLayout"}),Object(c.b)("h2",{id:"fork-github-docker-elk"},"Fork github docker-elk"),Object(c.b)("p",null,Object(c.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/deviantony/docker-elk"}),"https://github.com/deviantony/docker-elk")),Object(c.b)("h2",{id:"create-a-branch"},"Create a branch"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"git checkout -b autotest\ngit push --set-upstream origin autotest\n")),Object(c.b)("h2",{id:"modify-settings"},"Modify Settings"),Object(c.b)("h3",{id:"docker-composeyml"},"docker-compose.yml"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"elasticsearch")),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{}),'-      - type: volume\n-        source: elasticsearch\n+      - type: bind\n+        source: /srv/elk/elasticsearch\n\n-      ES_JAVA_OPTS: "-Xmx256m -Xms256m"\n+      ES_JAVA_OPTS: "-Xmx2048m -Xms2048m"\n\n-volumes:\n-  elasticsearch:\n')),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"logstash")),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{}),'+      - "5044:5044/tcp"\n+      - "5044:5044/udp"\n\n-      LS_JAVA_OPTS: "-Xmx256m -Xms256m"\n+      LS_JAVA_OPTS: "-Xmx2048m -Xms2048m"\n')),Object(c.b)("h3",{id:"elasticsearchconfigelasticsearchyml"},"elasticsearch/config/elasticsearch.yml"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{}),"-xpack.license.self_generated.type: trial\n+xpack.license.self_generated.type: basic\n")),Object(c.b)("h3",{id:"prepare-images"},"prepare images"),Object(c.b)("p",null,Object(c.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/colinzuo/kubernetes"}),"https://github.com/colinzuo/kubernetes")),Object(c.b)("p",null,"pull from docker.elastic.co"),Object(c.b)("p",null,"push to private registry"),Object(c.b)("p",null,"login to private registry"),Object(c.b)("h3",{id:"prepare-directories"},"prepare directories"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"mkdir -p /srv/elk/elasticsearch\nchown 1000:1000 /srv/elk/elasticsearch\n")),Object(c.b)("h3",{id:"startup-containers"},"startup containers"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"docker-compose up -d\n")),Object(c.b)("h3",{id:"setting-up-user-authentication"},"setting-up-user-authentication"),Object(c.b)("p",null,Object(c.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/deviantony/docker-elk#setting-up-user-authentication"}),"https://github.com/deviantony/docker-elk#setting-up-user-authentication")),Object(c.b)("h3",{id:"setup-filebeat"},"Setup Filebeat"),Object(c.b)("p",null,Object(c.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/colinzuo/beats"}),"https://github.com/colinzuo/beats")),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Load Template")),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"export   ELASTICSEARCH_HOSTS=172.16.23.70:9200\nexport ELASTICSEARCH_USERNAME=elastic\nexport ELASTICSEARCH_PASSWORD=ezhTRZKhX2ItULXy1tXd\n\n./filebeat -c filebeat.yml.orig setup --index-management -E output.logstash.enabled=false\n")),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Create Configuration file\n",Object(c.b)("a",Object(r.a)({parentName:"p"},{href:"/dddtdd-docs/docs/assets/files/filebeat_auto_portal.yml"}),"Sample Configuration"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Start filebeat"))),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"nohup ./filebeat -c filebeat_auto_portal.yml > start_filebeat_log.txt 2>&1 &\n")),Object(c.b)("h3",{id:"setup-index-patterns-on-kibana"},"Setup Index Patterns on Kibana"),Object(c.b)("p",null,"such as"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"filebeat-autotest-audit-*"),Object(c.b)("li",{parentName:"ul"},"filebeat-autotest-norm-*"),Object(c.b)("li",{parentName:"ul"},"logstash-*")),Object(c.b)("h3",{id:"save-popular-search"},"Save Popular Search"))}s.isMDXComponent=!0},230:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return m}));var r=a(0),n=a.n(r);function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){c(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},c=Object.keys(e);for(r=0;r<c.length;r++)a=c[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)a=c[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var b=n.a.createContext({}),s=function(e){var t=n.a.useContext(b),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=s(e.components);return n.a.createElement(b.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},d=n.a.forwardRef((function(e,t){var a=e.components,r=e.mdxType,c=e.originalType,i=e.parentName,b=o(e,["components","mdxType","originalType","parentName"]),u=s(a),d=r,m=u["".concat(i,".").concat(d)]||u[d]||p[d]||c;return a?n.a.createElement(m,l(l({ref:t},b),{},{components:a})):n.a.createElement(m,l({ref:t},b))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var c=a.length,i=new Array(c);i[0]=d;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var b=2;b<c;b++)i[b]=a[b];return n.a.createElement.apply(null,i)}return n.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"}}]);